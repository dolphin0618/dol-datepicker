/*
  dol-datepicker 0.1.0 <https://github.com/dolphin0618/dol-datepicker>
  shanghang 2017-12-12
*/
var Datepicker=function(){var c,a={on:function(b,c,d,e){return"string"==typeof d?b.addEventListener(c,function(a){a.target.tagName===d.toLocaleUpperCase()&&(e.call(a.target,a),a.stopPropagation())},!1):(e=d,b.addEventListener(c,function(a){e.call(this,a),a.stopPropagation()},!1)),a},extend:function(b,c,d){function e(a){try{if(a.constructor&&!hasOwn.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0}for(var f in c)d&&(e(c[f])||Array.isArray(c[f]))?(e(c[f])&&!e(b[f])&&(b[f]={}),Array.isArray(c[f])&&!Array.isArray(b[f])&&(b[f]=[]),a.extend(b[f],source[f],d)):void 0!==c[f]&&(b[f]=c[f])},isShow:function(a,b){a.style.display=b?"block":"none"},format:function(b,c){var d=new Date(b);return c.replace(/YYYY|MM|DD|hh|mm|ss/g,function(b,c){return c=0,"YYYY"===b?c=d.getFullYear():"MM"===b?c=d.getMonth()+1:"DD"===b?c=d.getDate():"hh"===b?c=d.getHours():"mm"===b?c=d.getMinutes():"ss"===b&&(c=d.getSeconds()),a.repair(c)})},parse:function(b,c){if(1===b){b=c.value.match(/\d+/g);for(var d=[],e=0;e<c.aYmdIndex.length;e++)d.push(b[c.aYmdIndex[e]]);return d}return 2===b?(c.value=a.format(c.time,c.format),a.parse(1,c)):void 0},repair:function(a){return(10>a?"0":"")+a},each:function(a,b){for(var c=0,d=a.length;d>c&&!1!==b(c,a[c]);c++);},check:function(a,b,c){function d(a,b){return b||(b=[1970,1,1,0,0,0]),+new Date(e(a[0],b[0]),e(a[1],b[1])-1,e(a[2],b[2]),e(a[3],b[3]),e(a[4],b[4]),e(a[5],b[5]))}function e(a,b){return void 0===a?void 0===b?0:b:a}return d(a,b)<d(b)||d(a,c)>d(c)},scroll:function(a){return a=a?"scrollLeft":"scrollTop",document.body[a]|document.documentElement[a]}},b=function(b){var e,d=this;if(this.config={format:"YYYY-MM-DD",min:"1970-01-01 00:00:00",max:"2099-12-12 23:59:59",eventtype:"",elemName:"",hasTime:!0,hasClear:!0,hasToday:!0,hasConfirm:!0,fixed:!1,callBack:null},a.extend(this.config,b),this.config.min=this.parse(this.config.min,"YYYY-MM-DD")+" 00:00:00",this.config.max=this.parse(this.config.max,"YYYY-MM-DD")+" 23:59:59",this.elem=document.getElementById(this.config.elemName),!this.elem)throw Error("ID选择器找不到元素");e=/textarea|input/.test(this.elem.tagName.toLocaleLowerCase())?"value":"innerHTML",this.getExg(),this.check(this.elem[e]),a.on(this.elem,this.eventtype||"click",function(){d.check(d.elem[e]),c.redraw(d,e)})};return b.prototype.setMinScope=function(b,c){this.config.min=b,c&&"number"==typeof b&&(this.config.min=a.format(b+864e5*c,this.config.format))},b.prototype.setMaxScope=function(b,c){this.config.max=b,c&&"number"==typeof b&&(this.config.max=a.format(b+864e5*c,this.config.format))},b.prototype.getExg=function(){this.aYmdIndex=Array(6);var a=this,b=0,c=this.config.format.replace(/YYYY|MM|DD|hh|mm|ss/g,function(c,d){return d="","YYYY"===c?(d+="((19|20)\\d{2})",a.aYmdIndex[0]=b):"MM"===c?(d+="(0?[1-9]|1[0-2])",a.aYmdIndex[1]=b):"DD"===c?(d+="(0?[1-9]|[1-3][0-9])",a.aYmdIndex[2]=b):"hh"===c?(d+="\\d{2}",a.aYmdIndex[3]=b):"mm"===c?(d+="\\d{2}",a.aYmdIndex[4]=b):"ss"===c&&(d+="\\d{2}",a.aYmdIndex[5]=b),b++,d});this.reg=new RegExp("^"+c+"$")},b.prototype.check=function(b){this.aYmd=this.reg.test(b)?a.parse(1,{aYmdIndex:this.aYmdIndex,value:b}):a.parse(2,{aYmdIndex:this.aYmdIndex,value:b,format:"YYYY-MM-DD",time:+new Date})},b.prototype.parse=function(b,c){return"string"==typeof b?b:a.format(864e5>b?+new Date+864e5*b:b,c||"YYYY-MM-DD")},c={dom:null,firstRedraw:!1,_init:function(){this.dom=document.createElement("div"),this.dom.className="datepicker-sh",this.dom.innerHTML='<div class="dp_top"><div class="dp_box box1" id="box1"><a href="javascript:;" class="dp_prevX"></a><div class="dp_year"><span class="dp_year_val"><span class="val">2015</span>年</span><span class="dp_down dp_year_next"></span><div class="dp_year_listBox"><a href="javascript:;" class="dp_prevY"></a><ul class="dp_year_list"></ul><a href="javascript:;" class="dp_nextY"></a></div></div><a href="javascript:;" class="dp_nextX"></a></div><div class="dp_box box2" id="box2"><a href="javascript:;" class="dp_prevX"></a><div class="dp_month"><span class="dp_month_val"><span class="val">1</span>月</span><span class="dp_down dp_month_next"></span><div class="dp_month_listBox"><ul class="dp_month_list"></ul></div></div><a href="javascript:;" class="dp_nextX"></a></div></div><div class="db_body"><ul class="db_li db_week"><li>日</li><li>一</li><li>二</li><li>三</li><li>四</li><li>五</li><li>六</li></ul><ul class="db_li db_day"></ul></div><div class="dp_bottom"><div class="dp_time"><span class="dp_timefont">时间</span><ul class="dp_time_box"><li><input type="text" value="00" class="hh">:</li><li><input type="text" value="00" class="mm">:</li><li><input type="text" value="00" class="ss"></li></ul></div><div class="dp_btns"><a href="javascript:;" class="dp_btn clear">清空</a><a href="javascript:;" class="dp_btn dp_cl_r today">今天</a><a href="javascript:;" class="dp_btn dp_cl_r ok">确认</a></div><div class="dp_timebox dp_60"><div class="dp_head"><span class="db_title">秒</span><i class="db_close">×</i></div><ul class="db_time_list"></ul></div></div>',this._findDom(),this._events()},_findDom:function(){function a(a,b){return a.getElementsByClassName(b)[0]}var b=this.dom,c=a(b,"box1"),d=a(b,"box2");this.doms={yearBtn:a(c,"dp_year"),yearLeft:a(c,"dp_prevX"),yearRight:a(c,"dp_nextX"),yearInput:a(c,"val"),yearListBox:a(c,"dp_year_listBox"),yearTop:a(c,"dp_prevY"),yearBottom:a(c,"dp_nextY"),yearList:a(c,"dp_year_list"),monthBtn:a(d,"dp_month"),monthLeft:a(d,"dp_prevX"),monthRight:a(d,"dp_nextX"),monthInput:a(d,"val"),monthListBox:a(d,"dp_month_listBox"),monthList:a(d,"dp_month_list"),dayList:a(b,"db_day"),timeBox:a(b,"dp_time"),inputH:a(b,"hh"),inputM:a(b,"mm"),inputS:a(b,"ss"),btnBox:a(b,"dp_btns"),clearBtn:a(b,"clear"),todayBtn:a(b,"today"),okBtn:a(b,"ok"),timeListBox:a(b,"dp_timebox"),timeListTitle:a(b,"db_title"),timeListClose:a(b,"db_close"),timeList:a(b,"db_time_list")}},redraw:function(b,c){this.dateObj=b;var d=b.aYmd,e=b.config;b=b.elem,this.firstRedraw||(this.firstRedraw=!0,document.body.appendChild(this.dom)),this.aYmd=d,this.config=e,this.elem=b,this.valueType=c,this.maxArr=e.max.match(/\d+/g),this.minArr=e.min.match(/\d+/g),this.Y=d[0]?parseInt(d[0]):1970,this.M=d[1]?parseInt(d[1]):1,this.D=d[2]?parseInt(d[2]):1,this.h=d[3]?parseInt(d[3]):0,this.m=d[4]?parseInt(d[4]):0,this.s=d[5]?parseInt(d[5]):0,this.doms.yearInput.innerHTML=d[0],this.doms.monthInput.innerHTML=d[1],this._drawDate(this.Y,this.M,this.D),a.isShow(this.doms.timeBox,e.hasTime),this.doms.inputH.value=d[3]?d[3]:"00",this.doms.inputM.value=d[4]?d[4]:"00",this.doms.inputS.value=d[5]?d[5]:"00",a.isShow(this.doms.clearBtn,e.hasClear),a.isShow(this.doms.todayBtn,e.hasToday),a.isShow(this.doms.okBtn,e.hasConfirm),this._close(!0),this._position(b,e.fixed)},_checkDate:function(b){return a.check(b,this.minArr,this.maxArr)},_checkOk:function(){this._checkDate([this.Y,this.M,this.D,this.h,this.m,this.s])?(this.doms.okBtn.setAttribute("dis","yes"),this.doms.okBtn.className="dp_btn dp_cl_r dis"):(this.doms.okBtn.setAttribute("dis",""),this.doms.okBtn.className="dp_btn dp_cl_r ok")},_events:function(){var b=this,d=0,e="";a.on(this.doms.yearLeft,"click",function(){return b._checkDate([b.Y-1])?!1:(b.doms.yearInput.innerHTML=--b.Y,b._closelayer()._drawDate()._checkOk(),void 0)}),a.on(this.doms.yearRight,"click",function(){return b._checkDate([b.Y+1])?!1:(b.doms.yearInput.innerHTML=++b.Y,b._closelayer()._drawDate()._checkOk(),void 0)}),a.on(this.doms.yearBtn,"click",function(){d=0,b._closelayer()._drawYearList(d),a.isShow(b.doms.yearListBox,!0)}),a.on(this.doms.yearTop,"click",function(){b._drawYearList(--d)}),a.on(this.doms.yearBottom,"click",function(){b._drawYearList(++d)}),a.on(this.doms.yearList,"click","li",function(a){return this.getAttribute("dis")?(a.stopPropagation(),!1):(b.doms.yearInput.innerHTML=b.Y=parseInt(this.innerHTML),b._closelayer()._drawDate()._checkOk(),void 0)}),a.on(this.doms.monthLeft,"click",function(){return b._checkDate([b.Y,b.M-1])?!1:(1>--b.M&&(b.M=12,b.doms.yearInput.innerHTML=--b.Y),b.doms.monthInput.innerHTML=b.M,b._closelayer()._drawDate()._checkOk(),void 0)}),a.on(this.doms.monthRight,"click",function(){return b._checkDate([b.Y,b.M+1])?!1:(12<++b.M&&(b.M=1,b.doms.yearInput.innerHTML=++b.Y),b.doms.monthInput.innerHTML=b.M,b._closelayer()._drawDate()._checkOk(),void 0)}),a.on(this.doms.monthBtn,"click",function(){b._closelayer()._drawMonthList(),a.isShow(b.doms.monthListBox,!0)}),a.on(this.doms.monthList,"click","li",function(a){return this.getAttribute("dis")?(a.stopPropagation(),!1):(b.doms.monthInput.innerHTML=b.M=parseInt(this.innerHTML),b._closelayer()._drawDate()._checkOk(),void 0)}),a.on(this.doms.dayList,"click","li",function(a){return this.getAttribute("dis")?(a.stopPropagation(),!1):(b.M=this.getAttribute("m"),b.D=parseInt(this.innerHTML),b.selectDate()._checkOk(),c._close(),void 0)}),a.on(this.doms.timeListBox,"click",function(){}),a.on(this.doms.inputH,"click",function(){e="H",b._drawTimeList(e)}),a.on(this.doms.inputM,"click",function(){e="M",b._drawTimeList(e)}),a.on(this.doms.inputS,"click",function(){e="S",b._drawTimeList(e)}),a.on(this.doms.timeListClose,"click",function(){b._closelayer()}),a.on(this.doms.timeList,"click","li",function(c){return this.getAttribute("dis")?(c.stopPropagation(),!1):(c=parseInt(this.innerHTML),b[e.toLocaleLowerCase()]=c,b.doms["input"+e].value=a.repair(c),b._closelayer()._drawDate()._checkOk(),void 0)}),a.on(this.doms.clearBtn,"click",function(){b._close().elem[b.valueType]=""}),a.on(this.doms.todayBtn,"click",function(a){a=new Date,b.Y=a.getFullYear(),b.M=a.getMonth()+1,b.D=a.getDate(),b.selectDate()}),a.on(this.doms.okBtn,"click",function(a){return this.getAttribute("dis")?(a.stopPropagation(),!1):(b.selectDate(),void 0)}),a.on(document,"click",function(){b._closelayer(),c._close()}),a.on(this.dom,"click",function(){b._closelayer()})},_drawYearList:function(b){var c="",d=this;return a.each(Array(12),function(a){a=d.Y-5+a+12*b,c+=d._checkDate([a])?'<li dis="yes">'+a+"</li>":'<li class="normal">'+a+"</li>"}),this.doms.yearList.innerHTML=c,this},_drawMonthList:function(){var b="",c=this;return a.each(Array(12),function(d){b+=c._checkDate([c.Y,d+1])?'<li dis="yes">'+a.repair(d+1)+"</li>":'<li class="normal">'+a.repair(d+1)+"</li>"}),this.doms.monthList.innerHTML=b,this},_drawDate:function(){var d,g,h,i,e="",f=0,a=new Date(this.Y,this.M-1,0),b=new Date(this.Y,this.M,0),c=new Date(this.Y,this.M-1,1);for(a=a.getDate(),b=b.getDate(),c=c.getDay(),d=Math.min(b,this.D),g=1;42>=g;g++)c>=g?e+=this._checkDate([this.Y,this.M-1,a-c+g,this.h,this.m,this.s])?'<li dis="yes" m="'+(this.M-1)+'">'+(a-c+g)+"</li>":'<li class="other" m="'+(this.M-1)+'">'+(a-c+g)+"</li>":c+b>=g?(h=g-c,i=h===d?"on":"normal",e+=this._checkDate([this.Y,this.M,h,this.h,this.m,this.s])?'<li dis="yes" m="'+this.M+'">'+h+"</li>":'<li class="'+i+'" m="'+this.M+'">'+h+"</li>"):e+=this._checkDate([this.Y,this.M+1,f+1,this.h,this.m,this.s])?'<li dis="yes" m="'+(this.M+1)+'">'+ ++f+"</li>":'<li class="other" m="'+(this.M+1)+'">'+ ++f+"</li>";return this.doms.dayList.innerHTML=e,this},_drawTimeList:function(b){var c={H:{n:"时",c:24,e:"h",i:3},M:{n:"分",c:60,e:"m",i:4},S:{n:"秒",c:60,e:"s",i:5}},d="",e=this,f=[e.Y,e.M,e.D,e.h,e.m,e.s];a.each(Array(c[b].c),function(a){var g=e[c[b].e.toLocaleLowerCase()]===a?"on":"normal";f[c[b].i]=a,d+=e._checkDate(f)?'<li dis="yes">'+a+"</li>":'<li class="'+g+'">'+a+"</li>"}),this.doms.timeListBox.className="dp_timebox dp_"+c[b].c,this.doms.timeListTitle.innerHTML=c[b].n,this.doms.timeList.innerHTML=d,a.isShow(this.doms.timeListBox,!0)},_closelayer:function(){return a.isShow(this.doms.yearListBox,!1),a.isShow(this.doms.monthListBox,!1),a.isShow(this.doms.timeListBox,!1),this},_position:function(b,c){this.dom.style.position=c?"fixed":"absolute",b=b.getBoundingClientRect(),this.dom.style.left=b.left+(c?a.scroll(!0):0)+"px",this.dom.style.top=b.bottom+this.dom.offsetHeight<document.documentElement.clientHeight?b.bottom+(c?a.scroll():0)+"px":Math.max(b.top-document.documentElement.clientHeight+(c?a.scroll():0),0)+"px"},selectDate:function(){this.aYmd[0]=a.repair(this.Y),this.aYmd[1]=a.repair(this.M),this.aYmd[2]=a.repair(this.D),this.aYmd[3]=a.repair(this.h),this.aYmd[4]=a.repair(this.m),this.aYmd[5]=a.repair(this.s);var b=+new Date(this.Y,this.M-1,this.D,this.h,this.m,this.s);return this.elem[this.valueType]=a.format(b,this.config.format),this.config.callBack(this.elem[this.valueType],b),this.dateObj.time=b,this.dateObj.value=this.elem[this.valueType],this._close(),this},_close:function(a){return this.dom.style.display=a?"block":"none",this}},c._init(),b}();
